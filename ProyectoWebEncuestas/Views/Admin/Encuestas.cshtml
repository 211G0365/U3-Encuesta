@{
    Layout = "_LayoutAdmin";
}


<main class="encuestas-dashboard">
    <div class="encabezado-encuestas">
        <h1>Gestor de Encuestas</h1>
    </div>

    <section class="grid-encuestas" id="encuestasContainer">
        <p>Cargando encuestas...</p>
    </section>

    <a href="/Admin/AgregarEncuestas" class="btn-agregar-flotante" title="Agregar nueva encuesta" aria-label="Agregar nueva encuesta">＋</a>
</main>

<script>
    const token = localStorage.getItem("token");
    if (!token) {
        window.location.href = "/Login";
    }

    let encuestasGlobal = [];

    async function cargarEncuestas() {
        try {
            const response = await fetch("https://encuesta-api.websitos256.com/api/encuestas/encuestas", {
                method: "GET",
                headers: {
                    "Authorization": "Bearer " + token
                }
            });

            if (!response.ok) {
                throw new Error("No se pudieron cargar las encuestas");
            }

            const encuestas = await response.json();
            encuestasGlobal = encuestas;
            renderizarEncuestas(encuestas);
        } catch (error) {
            console.error(error);
            alert("Error al cargar las encuestas");
        }
    }

    function renderizarEncuestas(lista) {
        const container = document.getElementById("encuestasContainer");
        container.innerHTML = "";

        if (lista.length === 0) {
            container.innerHTML = "<p>No hay encuestas disponibles.</p>";
            return;
        }

        lista.forEach(encuesta => {
            const div = document.createElement("div");
            div.className = "encuesta-card";
            const fecha = new Date(encuesta.fechaCreacion).toLocaleDateString();
            div.innerHTML = `
                <div>
                    <h3>${encuesta.titulo}</h3>
                    <small>Creada el ${fecha}</small>
                </div>
                <div class="encuesta-acciones" role="group" aria-label="Acciones encuesta">
                    <a href="/Admin/EditarEncuestas?id=${encuesta.id}" title="Editar encuesta" aria-label="Editar encuesta ${encuesta.titulo}">✎</a>
                    <a href="/Admin/EliminarEncuestas?id=${encuesta.id}" title="Eliminar encuesta" aria-label="Eliminar encuesta ${encuesta.titulo}">🗑</a>
                    <a href="/Admin/VerAlumnosQueRespondieron?id=${encuesta.id}" title="Ver respuestas" aria-label="Ver respuestas encuesta ${encuesta.titulo}">📈</a>
                </div>
            `;
            container.appendChild(div);
        });
    }

    document.addEventListener("DOMContentLoaded", () => {
        cargarEncuestas();
    });
</script>
